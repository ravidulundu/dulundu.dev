// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model for authentication
model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  image         String?
  password      String
  role          String    @default("user") // admin, user
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  accounts      Account[]
  sessions      Session[]
  orders        Order[]

  @@map("users")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

// Product/Service model for selling
model Product {
  id          String   @id @default(cuid())
  slug        String   @unique
  type        String   // wordpress-plugin, wordpress-theme, consulting, optimization
  status      String   @default("draft") // draft, published, archived
  price       Decimal  @db.Decimal(10, 2)
  currency    String   @default("USD")
  stripeProductId String?
  stripePriceId   String?
  featured    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  translations ProductTranslation[]
  prices       ProductPrice[]
  orders      OrderItem[]

  @@index([status])
  @@index([featured])
  @@index([createdAt])
  @@index([status, featured])
  @@map("products")
}

// Product translations for multi-language support
model ProductTranslation {
  id          String  @id @default(cuid())
  productId   String
  locale      String  // en, tr, pt-BR
  title       String
  description String  @db.Text
  features    Json?   // Array of feature strings
  content     String? @db.Text // Long description/details
  coverImage  String? // Product cover/feature image URL

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, locale])
  @@map("product_translations")
}

model ProductPrice {
  id        String   @id @default(cuid())
  productId String
  currency  String
  amount    Decimal  @db.Decimal(10, 2)
  stripePriceId String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, currency])
  @@map("product_prices")
}

// Blog post model
model Post {
  id          String   @id @default(cuid())
  slug        String   @unique
  status      String   @default("draft") // draft, published, archived
  publishedAt DateTime?
  featured    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  translations PostTranslation[]

  @@index([status])
  @@index([featured])
  @@index([publishedAt])
  @@index([status, featured])
  @@index([status, publishedAt])
  @@map("posts")
}

// Blog post translations
model PostTranslation {
  id        String  @id @default(cuid())
  postId    String
  locale    String  // en, tr, pt-BR
  title     String
  excerpt   String  @db.Text
  content   String  @db.Text
  coverImage String?

  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([postId, locale])
  @@map("post_translations")
}

// Portfolio project model
model Project {
  id          String   @id @default(cuid())
  slug        String   @unique
  status      String   @default("draft") // draft, published, archived
  category    String   // wordpress, web-development, consulting
  url         String?
  githubUrl   String?  // GitHub repository URL (optional)
  featured    Boolean  @default(false)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  translations ProjectTranslation[]

  @@index([status])
  @@index([featured])
  @@index([order])
  @@index([category])
  @@index([status, featured])
  @@map("projects")
}

// Portfolio project translations
model ProjectTranslation {
  id           String  @id @default(cuid())
  projectId    String
  locale       String  // en, tr, pt-BR
  title        String
  description  String  @db.Text
  challenge    String? @db.Text  // Problem/challenge statement
  solution     String? @db.Text  // Solution approach description
  results      Json?   // Results metrics (e.g., {"speed": "50% faster", "conversion": "30% increase"})
  client       String? // Client name (optional)
  testimonial  String? @db.Text  // Client testimonial (optional)
  technologies Json?   // Array of technology strings
  images       Json?   // Array of image URLs

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, locale])
  @@map("project_translations")
}

// Order model for tracking purchases
model Order {
  id              String   @id @default(cuid())
  userId          String?
  customerEmail   String
  customerName    String?
  status          String   @default("pending") // pending, completed, failed, refunded
  total           Decimal  @db.Decimal(10, 2)
  currency        String   @default("USD")
  stripeSessionId String?  @unique
  stripePaymentIntent String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user  User?       @relation(fields: [userId], references: [id])
  items OrderItem[]

  @@index([userId])
  @@index([customerEmail])
  @@index([status])
  @@index([createdAt])
  @@index([status, createdAt])
  @@map("orders")
}

// Order items
model OrderItem {
  id        String  @id @default(cuid())
  orderId   String
  productId String
  quantity  Int     @default(1)
  price     Decimal @db.Decimal(10, 2)
  currency  String  @default("USD")

  order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id])

  @@map("order_items")
}

// Project inquiries
model Inquiry {
  id          String   @id @default(cuid())
  name        String
  email       String
  company     String?
  projectType String
  budget      String
  timeline    String
  description String   @db.Text
  status      String   @default("new") // new, contacted, closed
  notes       String?  @db.Text // Admin notes
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([status])
  @@index([createdAt])
  @@index([email])
  @@map("inquiries")
}
